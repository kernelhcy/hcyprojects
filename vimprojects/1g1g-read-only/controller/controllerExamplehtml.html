<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<title>1gcommander test</title>
		
	</head>
	<body style="margin:100px">
		<table width="100%" height="100%" cellpadding="0" cellspacing="0">
			<tr>
				<td valign="bottom" align="center">
					<div id="controller_1g1g" style="width:300px; height:16px;border:1px #ccc solid;padding:4px;cursor:pointer; "  onclick ="javascript:onControllerClick();">
						<div id="playPauseBtn_1g1g" style="width:16px;height:16px;background-image:url('image/asset.png');float:left;cursor:pointer;background-position:0px 0px;overflow:hidden" onmouseover="javascript:onPlayPauseBtnMouseOver();" onmouseout="javascript:onPlayPauseBtnMouseOut();" onclick ="javascript:onPlayPauseBtnClick();"></div>
						<div id="nextBtn_1g1g" style="width:16px;height:16px;background-image:url('image/asset.png');background-position:0px -64px;float:left;margin-left:5px;;cursor:pointer;overflow:hidden" onclick ="javascript:onNextBtnClick();" onmouseover="this.style.backgroundPosition='0px -80px';" onmouseout="this.style.backgroundPosition = '0px -64px'"></div>
						<div id="displayText_1g1g" style="font-size:12px;color:#990000;margin-left:42px;vertical-align:middle;">开始听歌</div>
					</div>
				</td>
			</tr>		
		</table>
		<div style="width:0;height:0;">
			<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="100%" height="100%" id="1gCommander">
				<param name="bgcolor" value="#333333" />
				<param name="movie" value="commander.swf"/>
				<param name="menu" value="false" />
				<param name="allowScriptAccess" value ="always" />
				<EMBED src="commander.swf" allowScriptAccess="always" menu="false" quality="high" bgcolor="#FFFFFF" width="100%" height="100%" name="1gCommander"  type="application/x-shockwave-flash" PLUGINSPAGE="http://www.macromedia.com/go/getflashplayer" />
			</object>
		</div>
		<script type="text/javascript">			
			
			var playPauseBtn_1g1g = document.getElementById("playPauseBtn_1g1g");
			var nextBtn_1g1g = document.getElementById("nextBtn_1g1g");
			var displayText_1g1g = document.getElementById("displayText_1g1g");
			var controller_1g1g = document.getElementById("controller_1g1g");
			var commander_1g1g = get1gCommander();
			var defaultDisplayText = "开始听歌";
			var playerState = "stop";
			var isConnected = false;
			controllerReset();
			
			
			function controllerReset()
			{
				displayText_1g1g.innerHTML = defaultDisplayText;
				playPauseBtn_1g1g.style.backgroundPosition = "0px 0px";
				controller_1g1g.style.cursor = "pointer";
				playerState = "stop";
				isConnected = false;			
			}
			function get1gCommander()
			{
				if (navigator.appName.indexOf("Microsoft") != -1) {
					return window["1gCommander"];
				} else {
					return document["1gCommander"];
				}
			}
			function onControllerClick()
			{
				if(!commander_1g1g.command("is1g1gPlayerOpen"))
				{
					open1g1gPlayer();
				}
			
			}
			function onConnect()
			{
				isConnected= true;
				commander_1g1g.command("getStatus", "playerState");
				commander_1g1g.command("getStatus", "currentSongInfo");
				controller_1g1g.style.cursor = "default";
			}
			
			function playerEventDispatcher(type, body) 
			{
				if(isConnected == false)
				{
					onConnect()
				}
				if(type == "currentSongInfo")
				{
					displayText_1g1g.innerHTML = body.name +"-" + body.singer;
				}
				else if(type == "lyricSentence")
				{					
					displayText_1g1g.innerHTML = body.lyricSentence;
				}
				else if(type == "playerState")
				{	
					playerState = body.state;
					if (playerState == "stop" || playerState == "paused") 
					{
						playPauseBtn_1g1g.style.backgroundPosition = "0px 0px";
						commander_1g1g.command("getStatus", "currentSongInfo");
					}
					else
					{
						playPauseBtn_1g1g.style.backgroundPosition = "0px -32px";
					}
				}
				else if(type == "disconnect")
				{
					controllerReset();
				}
				if(commanderPingTimer)
				{
					clearInterval(commanderPingTimer);
					commanderPingTimer = null;
				}
				
			} 
			function open1g1gPlayer()
			{
				window.open ('http://www.1g1g.com','newwindow','height=480,width=270, toolbar=no,menubar=no,scrollbars=no,resizable=yes,location=no,status=no') 
			}
			
			function onPlayPauseBtnClick()
			{
				if(commander_1g1g.command("is1g1gPlayerOpen"))
				{
					commander_1g1g.command("playPause");
				}
				else
				{
					open1g1gPlayer();
				}
			}
			function onPlayPauseBtnMouseOver()
			{
				if (playerState == "stop" || playerState == "paused") 
				{
					playPauseBtn_1g1g.style.backgroundPosition = "0 -16px"; 
				}
				else
				{
					playPauseBtn_1g1g.style.backgroundPosition = "0 -48px"
				}
				
			}
			function onPlayPauseBtnMouseOut()
			{
				if (playerState == "stop" || playerState == "paused") 
				{
					playPauseBtn_1g1g.style.backgroundPosition = "0px 0px"
				}
				else
				{
					playPauseBtn_1g1g.style.backgroundPosition = "0px -32px"
				}
			}
			function onNextBtnClick()
			{
				if(commander_1g1g.command("is1g1gPlayerOpen"))
				{
					commander_1g1g.command("next");
				}
				else
				{
					open1g1gPlayer();
				}
			}
			function onCommanderPingTimer()
			{
				try
				{
					commander_1g1g.command("registerClient");
				}
				catch(e)
				{
				
				}
			}
			var commanderPingTimer = setInterval(onCommanderPingTimer, 1000);
		</script>		
	</body>
</html>